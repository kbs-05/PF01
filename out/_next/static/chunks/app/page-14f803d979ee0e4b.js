(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8654:(e,t,a)=>{Promise.resolve().then(a.bind(a,9613))},9613:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P});var s=a(5155),n=a(2115);function r(){let[e,t]=(0,n.useState)(!1);return(0,s.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,s.jsx)("i",{className:"ri-school-line text-white w-6 h-6 flex items-center justify-center"})}),(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Pierre de la Fontaine"})]})}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>t(!e),className:"flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("i",{className:"ri-user-line text-blue-600 w-4 h-4 flex items-center justify-center"})}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Caissier"}),(0,s.jsx)("i",{className:"ri-arrow-down-s-line w-4 h-4 flex items-center justify-center text-gray-400"})]}),e&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border py-1 z-10",children:[(0,s.jsxs)("a",{href:"#",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,s.jsx)("i",{className:"ri-user-settings-line w-4 h-4 mr-2 flex items-center justify-center"}),"Profil"]}),(0,s.jsxs)("a",{href:"#",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[(0,s.jsx)("i",{className:"ri-settings-line w-4 h-4 mr-2 flex items-center justify-center"}),"Param\xe8tres"]}),(0,s.jsx)("hr",{className:"my-1"}),(0,s.jsxs)("a",{href:"#",className:"block px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:[(0,s.jsx)("i",{className:"ri-logout-box-line w-4 h-4 mr-2 flex items-center justify-center"}),"D\xe9connexion"]})]})]})})]})})})}var l=a(5317),i=a(3915),d=a(5404);let c=(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)({apiKey:"AIzaSyCcVV_FeUdY2y-o-50SXawHhZPSrS4nvVg",authDomain:"pf00-b9e58.firebaseapp.com",projectId:"pf00-b9e58",storageBucket:"pf00-b9e58.firebasestorage.app",messagingSenderId:"815924358207",appId:"1:815924358207:web:689db0dc393a6a18f19c8a",measurementId:"G-0KC2DSNN91"}),o=(0,l.aU)(c);(0,d.xI)(c);let m=async()=>{let e=(0,l.rJ)(o,"students");return(await (0,l.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},u=async e=>{let t=(0,l.P)((0,l.rJ)(o,"students"),(0,l._M)("class","==",e));return(await (0,l.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))},x=async e=>({id:(await (0,l.gS)((0,l.rJ)(o,"students"),{...e,createdAt:l.Dc.now()})).id,...e}),h=async()=>{let e=(0,l.rJ)(o,"payments");return(await (0,l.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},p=async e=>({id:(await (0,l.gS)((0,l.rJ)(o,"payments"),{...e,date:e.date?new Date(e.date):l.Dc.now()})).id,...e});var b=a(3319);function g(){let[e,t]=(0,n.useState)({totalStudents:0,paidThisMonth:0,totalAmount:0,pendingPayments:0,inscriptions:0,reinscriptions:0}),[a,r]=(0,n.useState)([]),[l,i]=(0,n.useState)([]),[d,c]=(0,n.useState)([]);return(0,n.useEffect)(()=>{!async function(){try{let e=await m(),a=await h();c(e),i(a);let s=new Date().getMonth()-8,n=["Septembre","Octobre","Novembre","D\xe9cembre","Janvier","F\xe9vrier","Mars","Avril","Mai"][s>=0?s:0],l=new Set(a.filter(e=>e.monthsPaid.includes(n)).map(e=>e.studentName)),d=a.reduce((e,t)=>e+t.amount,0),o=a.filter(e=>e.monthsPaid.includes("INSCRIPTION")).length,u=a.filter(e=>e.monthsPaid.includes("REINSCRIPTION")).length,x=new Date;x.setDate(x.getDate()-x.getDay()),x.setHours(0,0,0,0);let p=new Date(x);p.setDate(x.getDate()+6),p.setHours(23,59,59,999);let b=a.filter(e=>{let t=new Date(e.date);return t>=x&&t<=p}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());t({totalStudents:e.length,paidThisMonth:l.size,totalAmount:d,pendingPayments:e.length-l.size,inscriptions:o,reinscriptions:u}),r(b)}catch(e){console.error("Erreur chargement donn\xe9es tableau de bord:",e)}}()},[]),(0,s.jsxs)("div",{className:"p-6 bg-gray-50 min-h-screen",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Tableau de Bord"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Total \xc9l\xe8ves"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:e.totalStudents})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"\xc9l\xe8ves ayant pay\xe9 ce mois"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600",children:e.paidThisMonth})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Montant total pay\xe9"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-indigo-600",children:[e.totalAmount," FCFA"]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Paiements en attente"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-red-600",children:e.pendingPayments})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Inscriptions"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-purple-600",children:e.inscriptions})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"R\xe9inscriptions"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-yellow-600",children:e.reinscriptions})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"R\xe9partition mensuelle des paiements"}),(0,s.jsx)("div",{className:"space-y-4",children:["INSCRIPTION","REINSCRIPTION","Septembre","Octobre","Novembre","D\xe9cembre","Janvier","F\xe9vrier","Mars","Avril","Mai"].map((t,a)=>{let n=new Set(l.filter(e=>e.monthsPaid.includes(t)).map(e=>e.studentName)),r=e.totalStudents>0?n.size/e.totalStudents*100:0;return(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:t}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(r,"%")}})}),(0,s.jsx)("span",{className:"text-sm text-gray-500 w-12",children:n.size})]})]},a)})})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Derniers paiements (cette semaine)"}),(0,s.jsxs)("ul",{className:"divide-y divide-gray-200",children:[0===a.length&&(0,s.jsx)("li",{className:"py-2 text-center text-gray-500",children:"Aucun paiement cette semaine"}),a.map((e,t)=>(0,s.jsxs)("li",{className:"py-2 flex justify-between text-sm",children:[(0,s.jsx)("span",{children:e.studentName}),(0,s.jsx)("span",{children:e.monthsPaid.join(", ")}),(0,s.jsxs)("span",{children:[e.amount," FCFA"]}),(0,s.jsx)("span",{children:(0,b.GP)(new Date(e.date),"dd/MM/yyyy")})]},t))]})]})]})}let N=e=>{let t=f(e),a=window.open("","_blank");a&&(a.document.write(t),a.document.close(),a.focus(),a.print())},j=e=>{let t=new Blob([f(e)],{type:"text/html"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="recu_".concat(e.receiptNumber,"_").concat(e.studentName,".html"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},f=e=>'\n  <!DOCTYPE html>\n  <html lang="fr">\n  <head>\n    <meta charset="UTF-8" />\n    <title>Re\xe7u de paiement</title>\n    <style>\n      @media print {\n        @page { size: A5 landscape; margin: 10mm; }\n      }\n      body { font-family: Arial, sans-serif; font-size: 13px; margin: 0 auto; padding: 10px; max-width: 580px; line-height: 1.4; color: #212529; }\n      .header { text-align: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px; }\n      .school-name { font-size: 17px; font-weight: bold; color: #2563eb; }\n      .contact { font-size: 12px; }\n      .receipt-title { font-size: 15px; font-weight: bold; text-align: center; margin: 15px 0; text-decoration: underline; }\n      .receipt-info { background-color: #f9f9f9; padding: 12px; border-radius: 6px; }\n      .info-row { display: flex; justify-content: space-between; margin: 6px 0; border-bottom: 1px dashed #ccc; padding-bottom: 3px; }\n      .info-label { font-weight: bold; }\n      .amount { font-weight: bold; font-size: 14px; color: #28a745; }\n      .remainder { font-weight: bold; font-size: 13px; color: #dc3545; margin-top: 2px; display: block; }\n      .signature { text-align: right; margin-top: 20px; }\n      .signature-line { border-top: 1px solid #333; width: 130px; margin-top: 15px; margin-bottom: 5px; float: right; }\n      .footer { text-align: center; font-size: 10px; margin-top: 20px; color: #666; }\n    </style>\n  </head>\n  <body>\n    <div class="header">\n      <div class="school-name">Pierre de la Fontaine</div>\n      <div class="contact">AKAE apr\xe8s l\'\xc9cole publique Ozoungue</div>\n      <div class="contact">T\xe9l : 077 71 55 10 / 066 31 07 08 / 077 80 27 78 / 066 30 01 40</div>\n    </div>\n\n    <div class="receipt-title">RE\xc7U DE PAIEMENT</div>\n\n    <div class="receipt-info">\n      <div class="info-row"><span class="info-label">N\xb0 de re\xe7u :</span><span>'.concat(e.receiptNumber,'</span></div>\n      <div class="info-row"><span class="info-label">Ann\xe9e scolaire :</span><span>').concat(e.academicYear,'</span></div>\n      <div class="info-row"><span class="info-label">\xc9l\xe8ve :</span><span>').concat(e.studentName,'</span></div>\n      <div class="info-row"><span class="info-label">Mois pay\xe9s :</span><span>').concat(e.monthsPaid.join(", "),'</span></div>\n\n      \x3c!-- Mode et date au-dessus du montant --\x3e\n      <div class="info-row"><span class="info-label">Mode :</span><span>').concat(v(e.paymentMethod),'</span></div>\n      <div class="info-row"><span class="info-label">Date :</span><span>').concat(new Date(e.date).toLocaleDateString("fr-FR"),'</span></div>\n\n      \x3c!-- Montant pay\xe9 --\x3e\n      <div class="info-row"><span class="info-label">Montant pay\xe9 :</span><span class="amount">').concat(e.amount.toLocaleString()," CFA</span></div>\n\n      \x3c!-- Reste \xe0 payer sur une ligne s\xe9par\xe9e --\x3e\n      ").concat(e.remainder?'<div class="info-row"><span class="info-label">Reste \xe0 payer ('.concat(e.remainder.month,') :</span><span class="remainder">').concat(e.remainder.amount.toLocaleString()," CFA</span></div>"):"",'\n    </div>\n\n    <div class="signature">\n      <div>Signature du caissier</div>\n      <div class="signature-line"></div>\n      <div>Date : ').concat(new Date().toLocaleDateString("fr-FR"),'</div>\n    </div>\n\n    <div class="footer">Merci de conserver ce re\xe7u. Pour toute r\xe9clamation, contactez l\'administration.</div>\n  </body>\n  </html>\n  '),v=e=>{switch(e){case"cash":return"Esp\xe8ces";case"transfer":return"Virement bancaire";case"check":return"Ch\xe8que";case"mobile":return"Mobile Money";default:return e}};function y(){let[e,t]=(0,n.useState)({receiptNumber:"",class:"",studentName:"",studentMatricule:"",monthsPaid:[],remainderMonth:"",remainderAmount:"",amount:"",academicYear:""}),[a,r]=(0,n.useState)([]),[l,i]=(0,n.useState)("list"),[d,c]=(0,n.useState)(!1),[o,u]=(0,n.useState)(!1),[x,h]=(0,n.useState)(null),[b,g]=(0,n.useState)(!1),f=["INSCRIPTION","REINSCRIPTION","FOURNITURE","TENUE","POLO","POLO DE SPORT","Septembre","Octobre","Novembre","D\xe9cembre","Janvier","F\xe9vrier","Mars","Avril","Mai"];(0,n.useEffect)(()=>{(async()=>{r(await m())})()},[]);let v=e.class?a.filter(t=>t.class===e.class):[],y=e=>{let{name:s,value:n}=e.target;if("class"===s)t(e=>({...e,class:n,studentName:"",studentMatricule:""}));else if("studentName"===s){let e=a.find(e=>e.name===n);t(t=>({...t,studentName:n,studentMatricule:e?e.matricule:""}))}else t(e=>({...e,[s]:n}))},w=e=>{i(e),t(e=>({...e,studentName:"",studentMatricule:""}))},S=async t=>{t.preventDefault();let{receiptNumber:a,class:s,studentName:n,studentMatricule:r,monthsPaid:l,remainderMonth:i,remainderAmount:d,amount:o,academicYear:m}=e;if(!a||!s||!n||!r||0===l.length||!o||!m)return void alert("Veuillez remplir tous les champs obligatoires");u(!0);try{let e={receiptNumber:a,studentName:n,studentMatricule:r,monthsPaid:l,amount:parseFloat(o),paymentMethod:"cash",date:new Date().toISOString(),academicYear:m};d&&i&&(e.remainder={month:i,amount:parseFloat(d)});let t={id:(await p(e)).id,...e};h(t),c(!0),g(!0)}catch(e){console.error("Erreur lors du traitement du paiement:",e),alert("Erreur lors du traitement du paiement")}finally{u(!1)}};return(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Nouveau paiement"}),d&&x&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("i",{className:"ri-checkbox-circle-line text-green-600 w-5 h-5 mr-2"}),(0,s.jsx)("span",{className:"text-green-800",children:"Paiement enregistr\xe9 avec succ\xe8s !"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>N(x),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:[(0,s.jsx)("i",{className:"ri-printer-line mr-1"})," Imprimer"]}),(0,s.jsxs)("button",{onClick:()=>j(x),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:[(0,s.jsx)("i",{className:"ri-download-line mr-1"})," T\xe9l\xe9charger"]}),(0,s.jsxs)("button",{onClick:()=>{t({receiptNumber:"",class:"",studentName:"",studentMatricule:"",monthsPaid:[],remainderMonth:"",remainderAmount:"",amount:"",academicYear:""}),i("list"),c(!1),g(!1),h(null)},className:"bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700",children:[(0,s.jsx)("i",{className:"ri-add-line mr-1"})," Nouveau paiement"]})]})]})}),(0,s.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"receiptNumber",className:"block text-sm font-medium text-gray-700 mb-2",children:"N\xb0 de re\xe7u *"}),(0,s.jsx)("input",{type:"text",id:"receiptNumber",name:"receiptNumber",value:e.receiptNumber,onChange:y,placeholder:"Ex: 001",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:b})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"class",className:"block text-sm font-medium text-gray-700 mb-2",children:"Classe *"}),(0,s.jsxs)("select",{id:"class",name:"class",value:e.class,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:b,children:[(0,s.jsx)("option",{value:"",children:"S\xe9lectionner une classe"}),["2ANS","3ANS","4ANS","5ANS","1\xe8re","2\xe8me","3\xe8me","4\xe8me","5\xe8me"].map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"academicYear",className:"block text-sm font-medium text-gray-700 mb-2",children:"Ann\xe9e acad\xe9mique *"}),(0,s.jsx)("input",{type:"text",id:"academicYear",name:"academicYear",placeholder:"2024-2025",value:e.academicYear,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:b})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom de l'\xe9l\xe8ve *"}),(0,s.jsxs)("div",{className:"flex space-x-4 mb-3",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"studentInputType",value:"list",checked:"list"===l,onChange:()=>w("list"),className:"mr-2",disabled:b})," Liste"]}),(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"studentInputType",value:"manual",checked:"manual"===l,onChange:()=>w("manual"),className:"mr-2",disabled:b})," Manuel"]})]}),"list"===l?(0,s.jsxs)("select",{id:"studentName",name:"studentName",value:e.studentName,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:!e.class||b,children:[(0,s.jsx)("option",{value:"",children:e.class?"S\xe9lectionner un \xe9l\xe8ve":"Choisir d'abord une classe"}),v.map(e=>(0,s.jsxs)("option",{value:e.name,children:[e.name," (",e.matricule,")"]},e.id))]}):(0,s.jsx)("input",{type:"text",id:"studentName",name:"studentName",value:e.studentName,onChange:y,placeholder:"Nom de l'\xe9l\xe8ve",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:b})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"monthsPaid",className:"block text-sm font-medium text-gray-700 mb-2",children:"Mois pay\xe9s *"}),(0,s.jsx)("select",{id:"monthsPaid",name:"monthsPaid",multiple:!0,value:e.monthsPaid,onChange:e=>{let a=Array.from(e.target.selectedOptions).map(e=>e.value);t(e=>({...e,monthsPaid:a}))},className:"w-full h-40 px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:b,children:f.map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-2",children:"Montant pay\xe9 (CFA) *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"number",id:"amount",name:"amount",value:e.amount,onChange:y,placeholder:"15000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,disabled:b}),(0,s.jsx)("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"CFA"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reste \xe0 payer (si partiel)"}),(0,s.jsx)("input",{type:"number",name:"remainderAmount",value:e.remainderAmount,onChange:y,placeholder:"Montant restant",className:"w-full px-3 py-2 border border-gray-300 rounded-lg",disabled:b||!e.remainderAmount}),(0,s.jsxs)("select",{name:"remainderMonth",value:e.remainderMonth,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg mt-2",disabled:b||!e.remainderAmount,children:[(0,s.jsx)("option",{value:"",children:"Choisir le mois du reste"}),f.map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))]})]})]}),!b&&(0,s.jsx)("div",{className:"flex space-x-4",children:(0,s.jsx)("button",{type:"submit",disabled:o,className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50",children:o?(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)("i",{className:"ri-loader-4-line animate-spin w-5 h-5 mr-2"})," Traitement... "]}):(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)("i",{className:"ri-money-dollar-circle-line w-5 h-5 mr-2"})," Enregistrer le paiement "]})})})]})]})})}function w(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)([]),[l,i]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),o=["INSCRIPTION","REINSCRIPTION","FOURNITURE","TENUE","POLO","POLO DE SPORT","Septembre","Octobre","Novembre","D\xe9cembre","Janvier","F\xe9vrier","Mars","Avril","Mai"];(0,n.useEffect)(()=>{!async function(){try{let e=await m();t(e);let a=await h();r(a)}catch(e){console.error("Erreur lors du chargement des donn\xe9es:",e)}}()},[]);let u=e.filter(e=>{let t=e.name.toLowerCase().includes(l.toLowerCase())||e.matricule.toLowerCase().includes(l.toLowerCase()),a=""===d||e.class===d;return t&&a}),x=Array.from(new Set(e.map(e=>e.class))),p=(e,t)=>{let s=a.filter(t=>t.studentName===e),n=!1,r=!1;for(let e of s){var l;e.monthsPaid.some(e=>e.toLowerCase()===t.toLowerCase())&&(n=!0),(null==(l=e.remainder)?void 0:l.month.toLowerCase())===t.toLowerCase()&&e.remainder.amount>0&&(r=!0)}return n?"paid":r?"partial":"unpaid"};return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Suivi des paiements"}),(0,s.jsx)("button",{onClick:()=>{let e=new Blob([[["Matricule","Nom","Classe",...o],...u.map(e=>[e.matricule,e.name,e.class,...o.map(t=>{let a=p(e.name,t);return"paid"===a?"Pay\xe9":"partial"===a?"Partiel":"Non pay\xe9"})])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="suivi_paiements.csv",a.click(),window.URL.revokeObjectURL(t)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:(0,s.jsx)("span",{children:"Exporter CSV"})})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,s.jsx)("input",{type:"text",placeholder:"Rechercher un \xe9l\xe8ve ou matricule...",value:l,onChange:e=>i(e.target.value),className:"flex-1 px-4 py-2 border rounded-lg"}),(0,s.jsxs)("select",{value:d,onChange:e=>c(e.target.value),className:"sm:w-48 px-3 py-2 border rounded-lg",children:[(0,s.jsx)("option",{value:"",children:"Toutes les classes"}),x.map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))]})]}),(0,s.jsx)("div",{className:"overflow-x-auto bg-white border rounded-lg",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Matricule"}),(0,s.jsx)("th",{children:"\xc9l\xe8ve"}),(0,s.jsx)("th",{children:"Classe"}),o.map((e,t)=>(0,s.jsx)("th",{children:e.substring(0,3)},t))]})}),(0,s.jsx)("tbody",{children:0===u.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3+o.length,className:"text-center py-8",children:"Aucun \xe9l\xe8ve trouv\xe9"})}):u.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.matricule}),(0,s.jsx)("td",{children:e.name}),(0,s.jsx)("td",{children:e.class}),o.map((t,a)=>{let n=p(e.name,t);return(0,s.jsxs)("td",{className:"text-center",children:["paid"===n&&"✅","partial"===n&&"⚠️","unpaid"===n&&"❌"]},a)})]},e.id))})]})})]})}function S(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(""),[i,d]=(0,n.useState)(""),[c,o]=(0,n.useState)("date");(0,n.useEffect)(()=>{(async()=>{try{let e=await h();t(e)}catch(e){console.error("Erreur lors du chargement des paiements:",e)}})()},[]);let m=e=>{if(!e)return new Date(0);if(e instanceof l.Dc)return e.toDate();let t=new Date(e);return isNaN(t.getTime())?new Date(0):t},u=e.filter(e=>e.studentName.toLowerCase().includes(a.toLowerCase())||e.studentMatricule.toLowerCase().includes(a.toLowerCase())).filter(e=>{var t;return!i||e.monthsPaid.includes(i)||(null==(t=e.remainder)?void 0:t.month)===i}).sort((e,t)=>{if("amount"===c)return t.amount-e.amount;if("student"===c)return e.studentName.localeCompare(t.studentName);let a=m(e.date);return m(t.date).getTime()-a.getTime()}),x=u.reduce((e,t)=>e+t.amount,0);return(0,s.jsxs)("div",{className:"p-4 max-w-5xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Suivi des paiements"}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-4 mb-6",children:[(0,s.jsx)("input",{type:"text",placeholder:"Rechercher un \xe9l\xe8ve ou matricule",value:a,onChange:e=>r(e.target.value),className:"border p-2 rounded w-full md:w-1/3"}),(0,s.jsxs)("select",{value:i,onChange:e=>d(e.target.value),className:"border p-2 rounded w-full md:w-1/4",children:[(0,s.jsx)("option",{value:"",children:"Tous les mois"}),["INSCRIPTION","REINSCRIPTION","FOURNITURE","TENUE","POLO","POLO DE SPORT","Septembre","Octobre","Novembre","D\xe9cembre","Janvier","F\xe9vrier","Mars","Avril","Mai"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsxs)("select",{value:c,onChange:e=>o(e.target.value),className:"border p-2 rounded w-full md:w-1/4",children:[(0,s.jsx)("option",{value:"date",children:"Trier par date"}),(0,s.jsx)("option",{value:"amount",children:"Trier par montant"}),(0,s.jsx)("option",{value:"student",children:"Trier par nom"})]})]}),(0,s.jsxs)("div",{className:"mb-4 text-lg font-semibold",children:["Montant total : ",(0,s.jsxs)("span",{className:"text-green-600",children:[x.toLocaleString()," FCFA"]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full bg-white border rounded shadow",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-100 text-left",children:[(0,s.jsx)("th",{className:"p-3 border",children:"Nom de l'\xe9l\xe8ve"}),(0,s.jsx)("th",{className:"p-3 border",children:"Matricule"}),(0,s.jsx)("th",{className:"p-3 border",children:"Mois"}),(0,s.jsx)("th",{className:"p-3 border",children:"Montant"}),(0,s.jsx)("th",{className:"p-3 border",children:"Mode de paiement"}),(0,s.jsx)("th",{className:"p-3 border",children:"Date"})]})}),(0,s.jsxs)("tbody",{children:[0===u.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"text-center p-4",children:"Aucun paiement trouv\xe9"})}),u.map(e=>{let t=m(e.date),a=e.remainder?"".concat(e.monthsPaid.join(", ")," (reste ").concat(e.remainder.amount," pour ").concat(e.remainder.month,")"):e.monthsPaid.join(", ");return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"p-3 border",children:e.studentName}),(0,s.jsx)("td",{className:"p-3 border",children:e.studentMatricule}),(0,s.jsx)("td",{className:"p-3 border",children:a}),(0,s.jsxs)("td",{className:"p-3 border",children:[e.amount.toLocaleString()," FCFA"]}),(0,s.jsx)("td",{className:"p-3 border",children:e.paymentMethod}),(0,s.jsx)("td",{className:"p-3 border",children:t.getTime()>0?(0,b.GP)(t,"dd/MM/yyyy"):"Date invalide"})]},e.id)})]})]})})]})}function C(){let[e,t]=(0,n.useState)({nom:"",prenom:"",classe:"",matricule:""}),[a,r]=(0,n.useState)(!1),[l,i]=(0,n.useState)(!1),d=e=>{let{name:a,value:s}=e.target;t(e=>({...e,[a]:s}))},c=async e=>{let t=await u(e),a=0;t.forEach(e=>{if(e.matricule){let t=parseInt(e.matricule.split("-")[1],10);!isNaN(t)&&t>a&&(a=t)}});let s=String(a+1).padStart(3,"0");return"".concat(e,"-").concat(s)},o=async a=>{a.preventDefault(),r(!0);try{let a=await c(e.classe),s={name:e.nom+" "+e.prenom,class:e.classe,matricule:a,parentName:"",parentPhone:""};await x(s),i(!0),t({nom:"",prenom:"",classe:"",matricule:""})}catch(e){console.error("Erreur lors de l'ajout :",e),i(!1)}finally{r(!1)}};return(0,s.jsxs)("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded-xl shadow-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Ajouter un \xe9l\xe8ve"}),(0,s.jsxs)("form",{onSubmit:o,className:"space-y-4",children:[(0,s.jsx)("input",{type:"text",name:"nom",placeholder:"Nom",value:e.nom,onChange:d,className:"w-full p-2 border rounded",required:!0}),(0,s.jsx)("input",{type:"text",name:"prenom",placeholder:"Pr\xe9nom",value:e.prenom,onChange:d,className:"w-full p-2 border rounded",required:!0}),(0,s.jsx)("input",{type:"text",name:"matricule",placeholder:"Matricule (g\xe9n\xe9r\xe9 automatiquement)",value:e.matricule,className:"w-full p-2 border rounded bg-gray-100",disabled:!0}),(0,s.jsxs)("select",{name:"classe",value:e.classe,onChange:d,className:"w-full p-2 border rounded",required:!0,children:[(0,s.jsx)("option",{value:"",children:"S\xe9lectionner une classe"}),(0,s.jsx)("option",{value:"2ANS",children:"2ANS"}),(0,s.jsx)("option",{value:"3ANS",children:"3ANS"}),(0,s.jsx)("option",{value:"4ANS",children:"4ANS"}),(0,s.jsx)("option",{value:"5ANS",children:"5ANS"}),(0,s.jsx)("option",{value:"1\xe8re",children:"1\xe8re"}),(0,s.jsx)("option",{value:"2\xe8me",children:"2\xe8me"}),(0,s.jsx)("option",{value:"3\xe8me",children:"3\xe8me"}),(0,s.jsx)("option",{value:"4\xe8me",children:"4\xe8me"}),(0,s.jsx)("option",{value:"5\xe8me",children:"5\xe8me"})]}),(0,s.jsx)("button",{type:"submit",disabled:a,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:a?"Ajout en cours...":"Ajouter"}),l&&(0,s.jsx)("p",{className:"text-green-600",children:"\xc9l\xe8ve ajout\xe9 avec succ\xe8s ✅"})]})]})}function P(){let[e,t]=(0,n.useState)("dashboard");return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(r,{}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex space-x-1 mb-8 bg-white rounded-lg p-1 shadow-sm",children:[(0,s.jsxs)("button",{onClick:()=>t("dashboard"),className:"px-6 py-3 rounded-md font-medium transition-colors whitespace-nowrap ".concat("dashboard"===e?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)("i",{className:"ri-dashboard-line w-5 h-5 mr-2 flex items-center justify-center"}),"Tableau de bord"]}),(0,s.jsxs)("button",{onClick:()=>t("payment"),className:"px-6 py-3 rounded-md font-medium transition-colors whitespace-nowrap ".concat("payment"===e?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)("i",{className:"ri-money-dollar-circle-line w-5 h-5 mr-2 flex items-center justify-center"}),"Nouveau paiement"]}),(0,s.jsxs)("button",{onClick:()=>t("students"),className:"px-6 py-3 rounded-md font-medium transition-colors whitespace-nowrap ".concat("students"===e?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)("i",{className:"ri-group-line w-5 h-5 mr-2 flex items-center justify-center"}),"Liste des \xe9l\xe8ves"]}),(0,s.jsxs)("button",{onClick:()=>t("history"),className:"px-6 py-3 rounded-md font-medium transition-colors whitespace-nowrap ".concat("history"===e?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)("i",{className:"ri-history-line w-5 h-5 mr-2 flex items-center justify-center"}),"Historique"]}),(0,s.jsxs)("button",{onClick:()=>t("addStudent"),className:"px-6 py-3 rounded-md font-medium transition-colors whitespace-nowrap ".concat("addStudent"===e?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)("i",{className:"ri-user-add-line w-5 h-5 mr-2 flex items-center justify-center"}),"Ajouter \xe9l\xe8ve"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:["dashboard"===e&&(0,s.jsx)(g,{}),"payment"===e&&(0,s.jsx)(y,{}),"students"===e&&(0,s.jsx)(w,{}),"history"===e&&(0,s.jsx)(S,{}),"addStudent"===e&&(0,s.jsx)(C,{})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[135,965,549,441,684,358],()=>t(8654)),_N_E=e.O()}]);